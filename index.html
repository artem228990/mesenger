<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Приватний чат адаптивний</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #222;
      padding: 10px 15px;
      font-size: 18px;
      user-select: none;
      flex-shrink: 0;
    }
    #menu-toggle {
      font-size: 26px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      display: none; /* буде видно на мобілках */
    }
    #auth-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background: #1e1e1e;
      overflow-y: auto;
    }
    #auth-section input,
    #auth-section button {
      width: 90%;
      max-width: 300px;
      margin: 8px 0;
      padding: 12px;
      border-radius: 6px;
      border: none;
      font-size: 16px;
    }
    #auth-section input {
      background: #333;
      color: white;
    }
    #auth-section button {
      background: #009688;
      color: white;
      cursor: pointer;
    }
    #main-section {
      flex: 1;
      display: flex;
      height: 100vh;
      overflow: hidden;
      flex-direction: column;
    }
    /* Хедер для main-section */
    #main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #222;
      padding: 10px 15px;
      font-size: 18px;
      user-select: none;
      flex-shrink: 0;
    }

    /* Контакти під хедером */
    #users-list {
      background: #292929;
      overflow-y: auto;
      flex-grow: 1;
    }
    #users-list div {
      padding: 10px;
      margin: 0 10px 8px 10px;
      background: #3a3a3a;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
    }

    /* Меню, яке з’являється по кнопці меню */
    #sidebar-menu {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #222;
      color: white;
      padding: 20px;
      overflow-y: auto;
      display: none;
      z-index: 1000;
    }
    #sidebar-menu.active {
      display: block;
    }
    #sidebar-menu h3 {
      margin-top: 0;
    }
    #sidebar-menu button {
      width: 100%;
      margin: 8px 0;
      padding: 12px;
      border: none;
      border-radius: 6px;
      background: #009688;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    #sidebar-menu input[type="text"],
    #sidebar-menu input[type="file"] {
      width: 100%;
      margin-bottom: 12px;
      padding: 10px;
      border-radius: 6px;
      border: none;
      font-size: 16px;
      background: #333;
      color: white;
    }
    #sidebar-menu img.avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 12px;
      object-fit: cover;
    }

    /* Чат */
    #chat-section {
      display: none; /* прихований за замовчуванням */
      flex-direction: column;
      background: #1e1e1e;
      padding: 15px;
      height: 100vh;
      overflow: hidden;
    }
    #chat-section.active {
      display: flex;
    }
    #messages {
      flex: 1;
      overflow-y: auto;
      background: #2a2a2a;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      user-select: text;
    }
    #message-input {
      padding: 10px;
      border-radius: 6px;
      border: none;
      font-size: 16px;
      background: #333;
      color: white;
      margin-bottom: 8px;
      width: calc(100% - 100px);
      display: inline-block;
    }
    #btn-send-message {
      background: #009688;
      border: none;
      padding: 12px;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 16px;
      width: 80px;
      display: inline-block;
      vertical-align: top;
    }

    /* Кнопка закриття меню */
    #close-menu {
      background: none;
      border: none;
      color: white;
      font-size: 30px;
      position: absolute;
      top: 15px;
      right: 15px;
      cursor: pointer;
    }

    /* Приховати меню і чат на вході */
    #main-section.hidden,
    #main-header.hidden {
      display: none !important;
    }

    /* Мобільна адаптивність */
    @media (max-width: 768px) {
      #menu-toggle {
        display: block;
      }
      #users-list div {
        margin: 8px 10px;
      }
      #message-input {
        width: calc(100% - 100px);
      }
    }
  </style>
</head>
<body>
  <div id="top-notification" style="
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: #323232cc;
  color: white;
  padding: 10px 20px;
  border-radius: 25px;
  font-size: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.7);
  display: none;
  z-index: 2000;
  cursor: pointer;
  max-width: 90%;
  text-align: center;
  user-select: none;
"></div>


  <!-- Форма авторизації -->
  <div id="auth-section">
    <h2>Вхід або реєстрація</h2>
    <input id="email" type="email" placeholder="Email" required /><br />
    <input id="password" type="password" placeholder="Пароль" required /><br />
    <button id="btn-login">Увійти</button>
    <button id="btn-register">Зареєструватися</button>
  </div>

  <!-- Головний інтерфейс -->
  <div id="main-section" class="hidden">
    <header id="main-header">
      <span id="chat-with">Контакти</span>
      <button id="menu-toggle">&#9776;</button>
    </header>

    <div id="users-list"></div>

    <div id="chat-section">
      <h3>Чат з <span id="chat-with-name"></span></h3>
      <div id="messages"></div>
      <input id="message-input" type="text" placeholder="Написати повідомлення..." />
      <button id="btn-send-message">Відправити</button>
    </div>
  </div>

  <!-- Меню -->
  <div id="sidebar-menu">
    <button id="close-menu">&times;</button>
    <h3>Профіль</h3>
    <img id="user-avatar" src="" alt="Аватар" class="avatar" />
    <p id="user-email"></p>
    <input id="nickname-input" type="text" placeholder="Нікнейм" />
    <input id="avatar-input" type="file" accept="image/*" />
    <button id="btn-update-profile">Оновити профіль</button>
    <button id="btn-logout">Вийти</button>
  </div>

  <script>
    // Елементи
    const authSection = document.getElementById('auth-section');
    const mainSection = document.getElementById('main-section');
    const mainHeader = document.getElementById('main-header');
    const menuToggle = document.getElementById('menu-toggle');
    const sidebarMenu = document.getElementById('sidebar-menu');
    const closeMenuBtn = document.getElementById('close-menu');

    const usersList = document.getElementById('users-list');

    const chatSection = document.getElementById('chat-section');
    const chatWithSpan = document.getElementById('chat-with-name');
    const messagesDiv = document.getElementById('messages');
    const messageInput = document.getElementById('message-input');
    const btnSendMessage = document.getElementById('btn-send-message');

    // Профіль в меню
    const userAvatar = document.getElementById('user-avatar');
    const userEmail = document.getElementById('user-email');
    const nicknameInput = document.getElementById('nickname-input');
    const avatarInput = document.getElementById('avatar-input');
    const btnUpdateProfile = document.getElementById('btn-update-profile');
    const btnLogout = document.getElementById('btn-logout');

    // Імітація користувача (поставити логіку Firebase тут)
    let currentUser = null;
    let currentChatUser = null;

    // Пример контактів
    const contacts = [
      { uid: '2', nickname: 'Вася' },
      { uid: '3', nickname: 'Марія' },
      { uid: '4', nickname: 'Іван' },
      { uid: '5', nickname: 'Олена' }
    ];

    // Функція показати контакти
    function renderContacts() {
      usersList.innerHTML = '';
      contacts.forEach(user => {
        const div = document.createElement('div');
        div.textContent = user.nickname;
        div.dataset.uid = user.uid;
        div.onclick = () => openChat(user);
        usersList.appendChild(div);
      });
    }

    // Відкрити чат з контактом
    function openChat(user) {
      currentChatUser = user;
      chatWithSpan.textContent = user.nickname;
      chatSection.classList.add('active');
      mainHeader.querySelector('span').textContent = 'Чат';
      usersList.style.display = 'none';
      messagesDiv.innerHTML = ''; // Очистити повідомлення (логіку додай)
    }

    // Закрити чат і повернутися до списку контактів
    function closeChat() {
      currentChatUser = null;
      chatSection.classList.remove('active');
      usersList.style.display = 'block';
      mainHeader.querySelector('span').textContent = 'Контакти';
    }

    // Обробник кнопки меню
    menuToggle.onclick = () => {
      sidebarMenu.classList.add('active');
    };

    closeMenuBtn.onclick = () => {
      sidebarMenu.classList.remove('active');
    };

    // Імітація входу
    document.getElementById('btn-login').onclick = () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      if(email && password) {
        // Тут має бути реальна авторизація
        currentUser = {
          uid: '1',
          email,
          nickname: 'Ти',
          avatar: ''
        };
        authSection.style.display = 'none';
        mainSection.classList.remove('hidden');
        renderContacts();
        userEmail.textContent = currentUser.email;
        nicknameInput.value = currentUser.nickname;
        userAvatar.src = currentUser.avatar || 'https://via.placeholder.com/80?text=Аватар';
      } else {
        alert('Введіть email і пароль');
      }
    };

    // Вийти з профілю
    btnLogout.onclick = () => {
      currentUser = null;
      authSection.style.display = 'flex';
      mainSection.classList.add('hidden');
      sidebarMenu.classList.remove('active');
      closeChat();
      document.getElementById('email').value = '';
      document.getElementById('password').value = '';
    };

    // Оновлення профілю (нікнейм)
    btnUpdateProfile.onclick = () => {
      if(!currentUser) return;
      currentUser.nickname = nicknameInput.value.trim() || currentUser.nickname;
      alert('Профіль оновлено');
      sidebarMenu.classList.remove('active');
    };

    // Відправка повідомлення (імітована)
    btnSendMessage.onclick = () => {
      if(!currentChatUser) return;
      const text = messageInput.value.trim();
      if(text) {
        const p = document.createElement('p');
        p.textContent = `Ти: ${text}`;
        messagesDiv.appendChild(p);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        messageInput.value = '';
      }
    };

    // Клавіша Enter для відправки
    messageInput.addEventListener('keydown', e => {
      if(e.key === 'Enter') {
        btnSendMessage.click();
      }
    });
const topNotification = document.getElementById('top-notification');

function showTopNotification(message, onClick) {
  topNotification.textContent = message;
  topNotification.style.display = 'block';

  // При кліку — ховаємо і виконуємо onClick
  topNotification.onclick = () => {
    topNotification.style.display = 'none';
    if(onClick) onClick();
  };

  // Автоматичне ховання через 3 секунди
  setTimeout(() => {
    topNotification.style.display = 'none';
  }, 3000);
}
function requestNotificationPermission() {
  if ('Notification' in window) {
    if (Notification.permission === 'default') {
      Notification.requestPermission();
    }
  }
}

function showBrowserNotification(title, options) {
  if ('Notification' in window && Notification.permission === 'granted') {
    new Notification(title, options);
  }
}
document.getElementById('btn-login').onclick = () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  if(email && password) {
    currentUser = {
      uid: '1',
      email,
      nickname: 'Ти',
      avatar: ''
    };
    authSection.style.display = 'none';
    mainSection.classList.remove('hidden');
    renderContacts();
    userEmail.textContent = currentUser.email;
    nicknameInput.value = currentUser.nickname;
    userAvatar.src = currentUser.avatar || 'https://via.placeholder.com/80?text=Аватар';

    // Запитуємо дозвіл на пуші
    requestNotificationPermission();
  } else {
    alert('Введіть email і пароль');
  }
};
btnSendMessage.onclick = () => {
  if(!currentChatUser) return;
  const text = messageInput.value.trim();
  if(text) {
    // Відправка власного повідомлення
    const p = document.createElement('p');
    p.textContent = `Ти: ${text}`;
    messagesDiv.appendChild(p);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    messageInput.value = '';

    // Імітація відповіді співрозмовника через 2 секунди
    setTimeout(() => {
      const reply = `Відповідь від ${currentChatUser.nickname}`;
      const p2 = document.createElement('p');
      p2.textContent = `${currentChatUser.nickname}: ${reply}`;
      messagesDiv.appendChild(p2);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      // Показуємо верхнє сповіщення
      showTopNotification(`Повідомлення від ${currentChatUser.nickname}`, () => {
        // При кліку на сповіщення відкриваємо чат (якщо чат прихований)
        if(!chatSection.classList.contains('active')) {
          openChat(currentChatUser);
        }
      });

      // Показуємо браузерне пуш-сповіщення, якщо вкладка не активна
      if(document.hidden) {
        showBrowserNotification(`Новe повідомлення від ${currentChatUser.nickname}`, {
          body: reply,
          icon: currentUser.avatar || 'https://via.placeholder.com/80?text=Аватар'
        });
      }

    }, 2000);
  }
};

  </script>
  
</body>
</html>
